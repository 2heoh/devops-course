# Что это?

Пример с воркшопа на hexlet как разворачивать приложение в облаке

## Что входит?

Очень простое приложение на рельсах которое засовывается в контейнер
```
ansible/ - скрипты в основном для деплоя на бой + это единое (почти) место, где хранятся все переменные
services/
	blink/ - просто приложение на рельсах (одна страница + 1 тест)
	nginx/ - proxy-сервер
terraform/ - скрипты для создания кластера на DO
```
## Как рабоать

Почти все что нужно в Makefile

### Разработка
```
make app-build 					- собирает локальный docker image
make app       					- запускает приложение для локальной работы
```

### Секреты
```
make ansible-vaults-encrypt 	- создаем vault
make ansible-vaults-edit 		- правим vault
```

### Боевая среда

для начала нужны дропелеты куда ставить - см. **Terraform**

```
make production-ping			- проверяем что тачки живы и ssh работает
make production-setup			- ставим docker
make production-deploy 			- поднимаем приложение и nginx
make production-deploy-app		- ставим только
```

### Terraform

нужен terraform.tfvars
```
do_token = "<реальный токен из DO>"
```

## TODO
* Поупражняться со state - прикрутить к приложению базу и порабоать с ней в бою
* Причесать все переменные и названия сущностей
* Шаблонизировать создание do.tf из ansible
* Добавить пользователя на ноды в DO и запускать не из-под root :)
